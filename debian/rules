#!/usr/bin/make -f

ifneq (,$(findstring noopt,$(DEB_BUILD_OPTIONS)))
  export CXXFLAGS=-g -O0 -fno-inline
else
  export CXXFLAGS=-g -O2
endif

build-arch: build-stamp-arch
build-stamp-arch:
	dh_testdir

	./configure --prefix=/usr
	$(MAKE)
	$(MAKE) check

	touch build-stamp-arch

build-indep: build-stamp-indep
build-stamp-indep:
	dh_testdir

	./configure --prefix=/usr
	$(MAKE) doc

	touch build-stamp-indep

build: build-arch build-indep


clean:
	dh_testdir
	dh_testroot
	rm -f build-stamp-indep build-stamp-arch

	[ ! -f Makefile ] || $(MAKE) distclean

	dh_clean


install: build-arch
	dh_testdir
	dh_testroot
	dh_clean -k

	$(MAKE) install DESTDIR=`pwd`/debian/tmp gnulocaledir=`pwd`/debian/tmp/usr/share/locale


binary-arch: install
	dh_testdir -a
	dh_testroot -a
	dh_install -a
	dh_installdocs -a
	dh_installexamples -plibcwidget-dev src/cwidget/testcwidget.cc
	dh_installchangelogs -a

	dh_strip -a --dbg-package=libcwidget1-dbg
	dh_compress -a
	dh_fixperms -a
	dh_makeshlibs -a
	dh_shlibdeps -a
	dh_gencontrol -a
	dh_installdeb -a
	dh_md5sums -a
	dh_builddeb -a

binary-indep: build-indep
	dh_testdir -i
	dh_testroot -i
	dh_install -i
	dh_installdocs -i
	dh_installchangelogs -i

	dh_compress -i
	dh_fixperms -i
	dh_shlibdeps -i
	dh_gencontrol -i
	dh_installdeb -i
	dh_md5sums -i
	dh_builddeb -i

binary: binary-arch binary-indep
